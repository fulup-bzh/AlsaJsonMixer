"use strict";var ngapp=angular.module("mixer-ui-app",["ngRoute","ui-notification","bzm-range-slider","mm.foundation","ajm-knob-knob","ajm-playback-switch","ajm-register-numid","ajm-mixer-connect","ajm-monitor-gateway","ajm-matrix-route","ajm-matrix-fader","ajm-master-volume","ajm-matrix-label"]);ngapp.config(["$routeProvider","$locationProvider","$controllerProvider","$compileProvider","$filterProvider","$provide",function(e,t,i,a,n){var l;ngapp.addController=i.register,ngapp.addDirective=a.directive,ngapp.routeProvider=e,ngapp.provide=n,l=AJG_GLOBAL_DEBUG?["/mixers/dev/ScarlettMasterMod.js","/mixers/dev/ScarlettMixerMod.js","/mixers/dev/ScarlettCaptureMod.js"]:["/mixers/js/scarlett-mixer.js"],e.when("/",{templateUrl:"partials/mixer-connect.html"}).when("/scarlett",{templateUrl:"partials/scarlett-mixer.html",controller:"ScarlettMixerController as Scarlett",resolve:{deps:["$q","$rootScope",function(e,t){var i=e.defer();return $script(l,function(){t.$apply(function(){i.resolve()})}),i.promise}]}}).when("/scarlett-18i8-usb",{redirectTo:"/scarlett"}).when("/scarlett-18i20-usb",{redirectTo:"/scarlett"}).when("/scarlett-6i6-usb",{redirectTo:"/scarlett"}).otherwise({redirectTo:"/"})}]);var newModule=angular.module("ajm-knob-knob",[]);function ajgMasterVolume(a){return{template:'<div class="ajm-master-volume"> <p class="ajm-volume-title">"{{panelTitle}}"</p><knob-knob ng-repeat="volume in volumes"  title="{{volume.channel.label}}" callback="callback"   class="ajm-volume-knob valuecount-{{volume.channel.count}}" initvalues="volume"></knob-knob></div>',scope:{callback:"=",initvalues:"="},restrict:"E",link:function(t,e,i){t.initWidget=function(e){void 0!==e&&(200<e.numid&&a.log("master-volume init=",e),t.volumes=e)},t.masterid=i.id|"master-"+parseInt(1e3*Math.random()),t.$watch("initvalues",function(){t.initvalues&&t.initWidget(t.initvalues)}),t.panelTitle=i.panelTitle||"Volumes"}}}function labelByUid(){this.labelbyuid=[];var e=this;this.$get=function(){return e},this.register=function(e){e&&(this.labelbyuid[e.uid]=e)},this.setValue=function(e,t){e&&(this.labelbyuid[e]&&this.labelbyuid[e].setValue?this.labelbyuid[e].setValue(t):this.labelbyuid[e]={uid:e,label:t})},this.getPool=function(){var a=[],n=this.labelbyuid;return Object.keys(this.labelbyuid).forEach(function(e,t){var i=n[e];a.push({uid:i.uid,label:i.label})}),a},this.getValue=function(e){if(this.labelbyuid[e])return this.labelbyuid[e].label},this.reset=function(){var i=this.labelbyuid;Object.keys(this.labelbyuid).forEach(function(e,t){i[e]&&i[e].setValue&&i[e].setValue(void 0)})}}function AjgNumidCtrlPool(){this.ctrlbynumid=[];var e=this;this.$get=function(){return e},this.register=function(e,t){t&&(this.ctrlbynumid[e]=t)},this.setValue=function(e,t){var i;!e||(i=this.ctrlbynumid[e])&&i.setValue&&i.setValue(t)},this.refreshPool=function(a){var n=this.ctrlbynumid;Object.keys(this.ctrlbynumid).forEach(function(e,t){var i;!n[e].getCbHandle||(i=n[e]).getCbHandle().mixgrp==a&&i.forceRefresh(50)})},this.getNumids=function(){var i=[];this.ctrlbynumid;return Object.keys(this.ctrlbynumid).forEach(function(e,t){i.push(parseInt(e))}),i},this.getPool=function(){var a=[],n=this.ctrlbynumid;return Object.keys(this.ctrlbynumid).forEach(function(e,t){var i=n[e];a.push({numid:i.numid,value:i.value})}),a},this.getValue=function(e){if(this.ctrlbynumid[e])return this.ctrlbynumid[e].value}}newModule.directive("knobKnob",["$log","$timeout","CtrlByNumid",function(e,a,n){return{template:'<div class="ajm-knob"  > <matrix-label class="ajm-knob-title" initvalues="channel"></matrix-label><div class="ajm-knob-button" ng-mouseover="mouseEnter()" > <i class="ajm-knob-top"></i><div class="ajm-knob-base" ></div><range-slider ng-show="actif || enter" formatter="setValue" callback="setValue" initvalues="ctrl"></range-slider></div><span class="ajm-knob-value">{{normalized}}</span></div>',scope:{callback:"=",initvalues:"="},restrict:"E",link:function(l,e,t,i){l.initWidget=function(e){void 0!==e&&(l.ctrl=e.ctrl,l.channel=e.channel,l.ctrl.notMore&&(l.range=l.ctrl.notMore-(l.ctrl.notLess||0)),l.handle||(l.handle=l.ctrl),l.setValue(l.ctrl.value),n.register(l.channel.numid,l))},l.setValue=function(e,t){if(!isNaN(e)){l.value=e;var i=l.value/l.range*360;l.rotate(i);for(var a=[],n=0;n<l.channel.count;n++)a.push(e);l.normalized=parseInt(Math.sqrt(e/l.range)*l.range),t&&l.callback&&l.callback(l.channel.numid,[l.normalized,l.normalized])}},l.rotate=function(e){var t=e%360;l.knobtop.css("transform","rotate("+t+"deg)")},l.toggleState=function(){l.actif?(l.actif=!1,e.removeClass("button-actif")):(l.actif=!0,e.addClass("button-actif"))},l.mouseEnter=function(){l.enter=!0,a.cancel(l.timeout),l.timeout=a(function(){l.enter=!1},3e3)},l.knobid=t.id|"knob-"+parseInt(1e3*Math.random()),l.knobtop=e.find("i"),l.notLess=t.notLess||0,l.notMore=t.notMore||100,l.range=l.notMore-l.notLess,l.masterid=t.id|"master-"+parseInt(1e3*Math.random()),l.$watch("initvalues",function(){l.initvalues&&l.initWidget(l.initvalues)})}}}]),(newModule=angular.module("ajm-master-volume",[])).directive("masterVolume",["$log",ajgMasterVolume]),(newModule=angular.module("ajm-matrix-fader",[])).directive("matrixFader",["$log","$timeout","CtrlByNumid",function(e,t,a){return{templateUrl:"partials/matrix-fader.html",scope:{callback:"=",initvalues:"="},restrict:"E",link:function(r,e,t,i){r.prefad=[],r.initWidget=function(e){if(e){var t=e[0];r.range=t[0].ctrl.notMore-t[0].ctrl.notLess,2==t[0].length&&(r.stereo=!0),r.MixerModel=e,r.ctrlById=[],r.sliderById=[],r.syncMix=[];e.length;for(var i=2===e[0].length,a=0;a<e.length;a++){i&&(r.syncMix[a]=!1);for(var n=e[a],l=0;l<n.length;l++){var s=n[l];r.ctrlById[s.channel.numid]=s.ctrl}}}},r.StereoMix=function(e,n){var l,t=angular.element(e.target);r.syncMix[n]?(r.syncMix[n]=!1,t.removeClass("pfl-button-actif"),Object.keys(r.sliderById).forEach(function(e,t){var i=r.sliderById[e].getCbHandle(),a=r.sliderById[e];i.idxin===n&&(a.updateClass("not-sync",!0),0!==i.idxout&&a.setDisable(!1))},r.sliderById)):(r.syncMix[n]=!0,l=0,Object.keys(r.sliderById).forEach(function(e,t){var i=r.sliderById[e].getCbHandle(),a=r.sliderById[e];i.idxin===n&&(r.sliderById[e].updateClass("not-sync",!1),0==i.idxout?l=a.getValue():(a.setDisable(!0),a.setValue(l)))},r.sliderById),t.addClass("pfl-button-actif"))},r.SliderInit=function(e){var t=e.getCbHandle();r.sliderById[t.numid]=e,a.register(t.numid,e)},r.FaderSliderCB=function(a,e){var t,n=[];if(null==e)return a;r.prefad.PFLM?Object.keys(r.sliderById).forEach(function(e,t){var i=r.sliderById[e].getCbHandle();r.sliderById[e].setValue(a),n.push(i.numid)},r.sliderById):(t=e.getCbHandle(),n.push(t.numid),r.syncMix[t.idxin]&&(r.sliderById[t.numid+1].setValue(a),n.push(t.numid+1)));var i=parseInt(Math.sqrt(a/r.range)*r.range);return r.ismuted||r.callback(n,i),i},r.ToggleMute=function(n,e){var a;e?(r.ismuted=!0,a=[],Object.keys(r.sliderById).forEach(function(e,t){var i=r.sliderById[e].getCbHandle();n==i.idxin&&a.push(i.numid)},r.sliderById),r.callback(a,0)):(r.ismuted=!1,Object.keys(r.sliderById).forEach(function(e,t){var i,a=r.sliderById[e].getCbHandle();n==a.idxin&&(i=r.sliderById[e].getValue(void 0),r.callback([a.numid],i))},r.sliderById))},r.PreFader=function(e,t){var i=angular.element(e.target);r.prefad[t]?(r.prefad[t]=!1,i.removeClass("pfl-button-actif"),"MUTL"==t&&r.ToggleMute(0,!1),"MUTR"==t&&r.ToggleMute(1,!1)):(r.prefad[t]=!0,i.addClass("pfl-button-actif"),"MUTL"==t&&r.ToggleMute(0,!0),"MUTR"==t&&r.ToggleMute(1,!0))},r.inputid=t.id||"analog-in-"+parseInt(1e3*Math.random()),r.name=t.name||"NoName",r.label=t.label||"NoLabel",r.switchid=t.id|"switch-"+parseInt(1e3*Math.random()),r.$watch("initvalues",function(){r.initvalues&&r.initWidget(r.initvalues)})}}}]),(newModule=angular.module("ajm-matrix-label",[])).provider("LabelByUid",labelByUid),newModule.directive("matrixLabel",["$log","LabelByUid",function(e,n){return{template:'<input type="text" class="ajm-matrix-label" ng-model="label" list={{list}} placeholder={{placeholder}} ng-model-options="'+"{ updateOn: 'default blur', debounce: {'default': 1000, 'blur': 0} }\">",scope:{initvalues:"=",label:"=",used:"=",callback:"="},restrict:"E",link:function(t,e,i,a){t.setValue=function(e){t.label=e},t.initWidget=function(){t.initvalues&&(t.list=i.list,t.placeholder=i.placeholder,t.uid=t.initvalues.uid,t.label=n.getValue(t.uid)||t.initvalues.label,n.register(t))},t.callback&&t.$watch("label",function(){t.callback(t.label,e)}),t.initWidget(),t.$watch("initvalues",t.initWidget)}}}]),(newModule=angular.module("ajm-matrix-route",[])).directive("lineInput",["$log","CtrlByNumid",function(e,t){var o=document.createElement("option");return{template:'<select title="{{channel.name}}" title={{channel.name}} ng-click="selected()"></select>',scope:{channel:"=",callback:"=",matrixLinesPool:"=",initvalues:"="},restrict:"E",link:function(s,r,e){s.selectElem=r[0].firstChild,s.initWidget=function(e){s.channel=e,s.selection=e.value,s.selectElem.value=e.value,t.register(s.channel.numid,s)},s.setValue=function(e){s.selection=e,s.selectElem.value=e},s.$watch("matrixLinesPool",function(){for(var e,t,i,a=r[0].firstChild,n=0;n<s.matrixLinesPool.length;n++){var l=(e=s.matrixLinesPool[n],t=a,i=void 0,i=o.cloneNode(!1),t.appendChild(i),i.label=e.name,i.textContent=e.name,i.value=e.id,i);s.matrixLinesPool[n].options.push(l),s.matrixLinesPool[n].used?l.disabled=!0:s.channel&&s.channel.value===n&&(s.callback(s.matrixLinesPool,s.channel,n,!0),l.selected=!0)}}),s.selected=function(){s.selection=s.selectElem.value,void 0!==s.selection&&(s.matrixLinesPool[s.selection].used?s.selection=s.channel.value:s.callback(s.matrixLinesPool,s.channel,s.selection))},s.initvalues&&s.initWidget(s.initvalues)}}}]),newModule.directive("matrixRoute",["$log",function(l){return{template:'<div class="ajm-matrix-route"><matrix-label class="ajm-route-label" initvalues="info"></matrix-label><div class="ajm-route-select" ng-repeat="line in MatrixLines"><line-input class="ajm-route-linein ajm-select-{{$index}}"  matrix-lines-pool="matrixLinesPool" initvalues="line" callback="selected"></line-input></div></div>',scope:{callback:"=",initvalues:"="},restrict:"E",link:function(n,e,t,i){n.leftLine="",n.rightLine="",n.prefad=[],n.initWidget=function(e){e&&(n.MatrixLines=e.lines,n.matrixLinesPool=e.matrixLinesPool,n.info={uid:e.uid,label:e.label})},n.selected=function(e,t,i,a){t&&(a||(l.log("free channel ",t.value),n.callback.free(e,t,t.value)),n.callback.take(e,t,i),t.value=i)},n.init=function(){n.inputid=t.id||"matrix-"+parseInt(1e3*Math.random()),n.name=t.name||"NoName",n.label=t.label||"NoLabel",n.initvalues&&n.initWidget(n.initvalues),n.$watch("initvalues",function(){n.initvalues&&n.initWidget(n.initvalues)})},n.init()}}}]),(newModule=angular.module("ajm-mixer-connect",[])).directive("mixerConnect",["$log","$timeout","$http","$location","$route",function(e,t,i,a,l){return{template:'<div class="ajm-mixer-connect"><div><i class="ajm-connect-title">{{title}}<i><monitor-status class="ajm-connect-status" icon={{icon}}"></monitor-status></div><div  ng-repeat="sndcard in sndcards"><div  title="{{sndcard.info}}" ng-click="selectCard($index)"> <div class="row ajm-connect-sndcard ajm-{{sndbrand (sndcard)}}"><div class="small-10 columns"><span class="ajm-connect-name"> {{sndcard.name}} </span></div><div class="small-1 columns"><span class="ajm-connect-uid">  {{sndcard.devid}}  </span></div></div></div></div></div>',scope:{},restrict:"E",link:function(n,e,t){n.sndbrand=function(e){return e.name.split(" ")[0].toLowerCase()},n.getCards=function(){var e=i.get("/jsonapi",{params:{request:"card-get-all"}});e.success(function(e,t,i,a){"AJG_sndlist"==e.ajgtype?(n.online=1,n.sndcards=e.data):alert("AJM:FATAL ajm-mixer-connect response="+e)}),e.error(function(e,t,i){n.online=0})},n.selectCard=function(e){var t;null!=e?(!(t="/"+n.sndcards[e].name.toLowerCase().replace(/ /g,"-"))in l.routes&&(t="/generic"),a.path(t).search("card","hw:"+n.sndcards[e].cardid)):alert("AJM:Fatal invalid sndcard index [please report bug]")},n.title=t.title||"Sound Cards @ Gateway",n.icon=t.icon,n.getCards()}}}]),(newModule=angular.module("ajm-monitor-gateway",[])).directive("monitorStatus",["$log","$timeout","$http","$location","Notification",function(e,t,i,a,l){var n=new function(e){this.pingrate=1e3*e,this.elems=[],this.status;var n=this;this.register=function(e){this.elems.push(e),this.status?(e.addClass("ajm-online"),e.removeClass("ajm-offline")):(e.addClass("ajm-offline"),e.removeClass("ajm-online"))},this.online=function(){for(var e=0;e<this.elems.length;e++)this.elems[e].addClass("ajm-online"),this.elems[e].removeClass("ajm-offline")},this.offline=function(){for(var e=0;e<this.elems.length;e++)this.elems[e].addClass("ajm-offline"),this.elems[e].removeClass("ajm-online")},this.getping=function(){var e=i.get("/jsonapi",{params:{request:"ping-get"}});e.success(function(e,t,i,a){n.status||(l.success({message:"Alsa Server Back to Live",delay:3e3}),n.online()),n.status=1}),e.error(function(e,t,i){n.status&&(l.warning({message:"Alsa Server Lost",delay:5e3}),n.offline()),n.status=0}),t(n.getping,n.pingrate)},this.getping()}(30);return{template:'<div class="ajm-monitor"><span class="ajm-monitor-gateway" ng-click="clicked($event)" >alsa://{{hostname}}:{{httpdport}}</span><i class="ajm-monitor-status fa fa-cog"></i></div>',scope:{callback:"="},restrict:"E",link:function(e,t,i){e.init=function(){e.icon=i.icon||"fa-cog",e.hostname=a.host(),e.httpdport=a.port(),n.register(t)},e.init()}}}]),(newModule=angular.module("ajm-playback-switch",[])).directive("playbackSwitch",["$log","CtrlByNumid",function(e,a){var s=0;return{template:'<div class="playback-switch" title="{{switch.name}}">   <span ng-repeat="count in indexes" ng-click="toggleState($event, $index)" class="playback-switch-button {{extraclass}}">{{count}}</span></div>',scope:{callback:"=",initvalues:"="},restrict:"E",link:function(n,l,e,t){n.initWidget=function(e){var t,i=[];if(void 0!==e){for(t=0;t<e.value.length;t++)i.push(s++);n.indexes=i,n.switch=e,a.register(e.numid,n),n.extraclass=1===t?"playback-switch-master":""}},l.find("span"),n.setValue=function(e){for(var t=n.switch.value,i=l.find("span"),a=0;a<t.length;a++)t[a]=e[a],t[a]?i.addClass("button-actif"):i.removeClass("button-actif"),i=i.next()},n.toggleState=function(e,t){var i=angular.element(e.target),a=n.switch.value;a[t]?(a[t]=!1,i.removeClass("button-actif")):(a[t]=!0,i.addClass("button-actif")),n.callback(n.switch.numid,n.switch.value)},"true"===e.first&&(s=1),n.switchid=e.id|"switch-"+parseInt(1e3*Math.random()),n.$watch("initvalues",function(){n.initvalues&&n.initWidget(n.initvalues)})}}}]),(newModule=angular.module("ajm-register-numid",[])).provider("CtrlByNumid",AjgNumidCtrlPool);