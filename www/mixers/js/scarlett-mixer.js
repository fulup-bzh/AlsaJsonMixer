"use strict";function scarletteCapture(a){function b(b,c,d,e){b.matrixSourcePool=[],b.ProcessVolumeMix=function(a){var b="Mix-"+a.name;if(0==a.volumes.length)var c={name:b,numid:a.route.numid,title:a.route.name};else for(var c={name:b,volumes:[]},d=0;d<a.volumes.length;d+=2){var e=a.volumes[d],f=a.volumes[d+1],g={left:{id:e.numid,actif:e.actif,value:e.value[0],notLess:e.ctrl.min,notMore:e.ctrl.max,byStep:e.ctrl.step,title:e.name},right:{id:f.numid,actif:f.actif,value:f.value[0],notLess:f.ctrl.min,notMore:f.ctrl.max,byStep:f.ctrl.step,title:f.name}};c.volumes.push(g)}return c},e.$formatters.unshift(function(c){if(c){for(var d=[],e=[],f=c.sources[1].ctrl.enums,g=0;g<f.length;g++)b.matrixSourcePool.push({id:g,name:f[g],used:!1,options:[]});for(var g=0;g<c.sources.length;g+=2){var h=c.sources[g],i=c.sources[g+1],j="["+(g+1)+"/"+(g+2)+"]",k={uid:h.numid+"-"+i.numid,title:"Stereo Capture Input "+j,label:"Line "+j,name:"Capt "+j,matrixSourcePool:b.matrixSourcePool,left:{name:h.name,actif:h.actif,numid:h.numid,value:h.value},right:{name:i.name,actif:i.actif,numid:i.numid,value:i.value}};d.push(k)}for(var l=0;l<c.mixes.length;l+=2){var m=c.mixes[l],n=c.mixes[l+1],o={name:"Mix-"+m.name+" / "+n.name,left:[],right:[]};a.log("leftMix=",m,"rightMix=",n),o.left=b.ProcessVolumeMix(m),o.right=b.ProcessVolumeMix(n),e.push(o)}b.mixerSources=d,b.mixesVolumes=e,a.log("mixesVolumes=",e)}}),b.updatePool=function(a,c){b.matrixSourcePool[a].used=c;for(var d=0;d<b.matrixSourcePool[a].options.length;d++)b.matrixSourcePool[a].options[d].disabled=c},b.takeLineInPool=function(a){0==a||b.matrixSourcePool[a].used||b.updatePool(a,!0)},b.freeLineInPool=function(a){0!=a&&b.updatePool(a,!1)},b.matrixSourcePoolCB={take:b.takeLineInPool,free:b.freeLineInPool}}return{templateUrl:"partials/scarlett-capture.html",require:"ngModel",scope:{callback:"="},restrict:"E",link:b}}function ScarlettController(a,b,c){var d=this;d.getControls=function(a){var b={request:"get-controls",sndcard:a},e=c.get("/alsa-json",{params:b});e.success(function(a){d.sndcard=a.sndcard;for(var b=[],c=[],e=0;e<a.controls.length;e++){var f=a.controls[e],g=f.name.toLowerCase().split(" ");if("input"===g[0]&&"capture"===g[3]&&b.push(f),"matrix"===g[0]&&"mix"===g[2]&&"volume"==g[5]){var h=g[3];c[h]||(c[h]={name:h.toUpperCase(),route:"",volumes:[]}),c[h].volumes.push(f)}"matrix"===g[0]&&"input"===g[2]&&"route"==g[4]}var i=[];c&&Object.keys(c).forEach(function(a){i.push(c[a])},c),d.alsamixer={sources:b,mixes:i}}),e.error(function(){alert("Fail to get Card Controls from AlsaJsonGateway")})},d.callback=function(b,c){a.log("Scarlett callback action=",b," value=",c)},d.init=function(){d.getControls(b.search().card)},d.init()}ngapp.addDirective("scarlettCapture",["$log",scarletteCapture]),ngapp.addController("ScarlettMixerController",["$log","$location","$http",ScarlettController]);