"use strict";function RangeSliderHandle(a){var b=[],c=[];this.getId=function(){return a.sliderid},this.getCbHandle=function(){return a.cbhandle},this.getView=function(d){return d||(d=0),a.value[d]===b[d]?c[d]:(b[d]=a.value[d],c[d]=a.formatter?a.formatter(a.value[d],a.ctrlhandle):a.value[d],c[d])},this.updateClass=function(b,c){a.updateClass(b,c)},this.forceRefresh=function(b){a.forceRefresh(b)},this.getValue=function(b){return b||(b=0),a.value[b]},this.getRelative=function(b){return b||(b=0),a.relative[b]},this.setValue=function(b,c){c||(c=0),a.setValue(b,c)},this.setDisable=function(b){a.setDisable(b)}}function bzmFoundationSlider(a,b,c){function d(a,d,e,f){a.initWidget=function(b){b.byStep&&(a.byStep=parseInt(b.byStep)),b.notMore&&(a.notMore=parseInt(b.notMore)),b.notLess&&(a.notLess=parseInt(b.notLess)),b.id&&(a.sliderid=b.id),void 0!==b.value&&(a.value=b.value,a.forceRefresh(50))},a.forceRefresh=function(b){var d=a.value;a.value=[void 0,void 0],c(function(){a.setValue(d[0],0),a.dual&&a.setValue(d[1],1)},b)},a.updateClass=function(a,b){b?d.addClass(a):d.removeClass(a)},a.setDisable=function(b){b?(d.addClass("disable"),a.handles[0].css("visibility","hidden"),a.dual&&a.handles[1].css("visibility","hidden")):(d.removeClass("disable"),a.handles[0].css("visibility","visible"),a.dual&&a.handles[1].css("visibility","visible"))},a.normalize=function(b){var c=a.notMore-a.notLess,d=b*c;if(a.byStep>0){var e=(d-d%a.byStep)/a.byStep,f=d%a.byStep,g=f>=.5*a.byStep?a.byStep:0,h=e*a.byStep+g+a.notLess;return h}if(a.byStep<0){var i=Math.pow(10,-1*a.byStep),h=a.notLess+parseInt(d*i)/i;return h}return d},a.getValue=function(b,c){a.relative[c]=a.vertical?(b-a.bounds.handles[c].getBoundingClientRect().height)/(a.bounds.bar.getBoundingClientRect().height-a.bounds.handles[c].getBoundingClientRect().height):b/(a.bounds.bar.getBoundingClientRect().width-a.bounds.handles[c].getBoundingClientRect().width);var d=a.normalize(a.relative[c]);d!=a.value[c]&&(d<a.startValue&&(d=a.startValue),d>a.stopValue&&(d=a.stopValue),a.viewValue=a.formatter?a.formatter(d,a.ctrlhandle):d,a.displays[c]&&a.displays[c].html(a.viewValue),a.value[c]=d,f&&f.$setViewValue(a.value),a.$apply(),d>a.startValue&&d<a.stopValue&&a.translate(b,c))},a.setStart=function(b){if(b>a.value[0]&&(a.dual?a.setValue(b,1):a.setValue(b,0)),a.vertical){var c=a.bounds.bar.getBoundingClientRect().height*(b-a.notLess)/(a.notMore-a.notLess);a.start.css("height",c+"px")}else{var c=a.bounds.bar.getBoundingClientRect().width*(b-a.notLess)/(a.notMore-a.notLess);a.start.css("width",c+"px")}a.startValue=b},a.setStop=function(b){if(b<a.value[0]&&(a.dual?a.setValue(b,1):a.setValue(b,0)),a.vertical){var c=a.bounds.bar.getBoundingClientRect().height*(b-a.notLess)/(a.notMore-a.notLess);a.start.css("height",c+"px")}else{var c=a.bounds.bar.getBoundingClientRect().width*(b-a.notLess)/(a.notMore-a.notLess);a.stop.css({right:0,width:a.bounds.bar.getBoundingClientRect().width-c+"px"})}a.stopValue=b},a.translate=function(b,c){if(a.vertical){var d=a.bounds.bar.getBoundingClientRect().height-b;if(a.handles[c].css({"-webkit-transform":"translateY("+d+"px)","-moz-transform":"translateY("+d+"px)","-ms-transform":"translateY("+d+"px)","-o-transform":"translateY("+d+"px)",transform:"translateY("+d+"px)"}),a.dual){if(a.relative[1]&&a.relative[0]){var e=(a.relative[1]-a.relative[0])*a.bounds.bar.getBoundingClientRect().height,f=a.relative[0]*a.bounds.bar.getBoundingClientRect().height;a.slider.css({bottom:f+"px",height:e+"px"})}}else a.slider.css("height",b+"px")}else if(a.handles[c].css({"-webkit-transform":"translateX("+b+"px)","-moz-transform":"translateX("+b+"px)","-ms-transform":"translateX("+b+"px)","-o-transform":"translateX("+b+"px)",transform:"translateX("+b+"px)"}),a.dual){if(a.relative[1]&&a.relative[0]){var g=(a.relative[1]-a.relative[0])*a.bounds.bar.getBoundingClientRect().width,f=a.relative[0]*a.bounds.bar.getBoundingClientRect().width;a.slider.css({left:f+"px",width:g+"px"})}}else a.slider.css("width",b+"px")},a.setValue=function(b,c){var d;b!==a.value[c]&&(void 0===b&&(b=0),b>a.notMore&&(b=a.notMore),b<a.notLess&&(b=a.notLess),a.vertical?(a.relative[c]=(b-a.notLess)/(a.notMore-a.notLess),0===c&&(d=a.relative[c]*a.bounds.bar.getBoundingClientRect().height+a.bounds.handles[c].getBoundingClientRect().height/2),1===c&&(d=a.relative[c]*a.bounds.bar.getBoundingClientRect().height)):(a.relative[c]=(b-a.notLess)/(a.notMore-a.notLess),d=a.relative[c]*(a.bounds.bar.getBoundingClientRect().width-a.bounds.handles[c].getBoundingClientRect().width)),a.translate(d,c),a.value[c]=b,a.viewValue=a.formatter?a.formatter(b,void 0):b,f&&f.$setViewValue(a.viewValue),a.displays[c]&&a.displays[c].html(a.viewValue))},a.keydown=function(b){switch(b.keyCode){case 39:case 38:a.byStep>0&&a.$apply(a.setValue(a.value[a.actif]+a.byStep,a.actif)),a.byStep<0&&a.$apply(a.setValue(a.value[a.actif]+1/Math.pow(10,-1*a.byStep),a.actif)),a.callback&&a.callback(a.value[a.actif],a.ctrlhandle);break;case 37:case 40:a.byStep>0&&a.$apply(a.setValue(a.value[a.actif]-a.byStep,a.actif)),a.byStep<0&&a.$apply(a.setValue(a.value[a.actif]-1/Math.pow(10,-1*a.byStep),a.actif)),a.callback&&a.callback(a.value[a.actif],a.ctrlhandle);break;case 27:a.handles[a.actif][0].blur()}},a.moveHandle=function(b,c,d){var e;a.vertical?(e=a.bounds.bar.getBoundingClientRect().bottom-d,e>a.bounds.bar.getBoundingClientRect().height&&(e=a.bounds.bar.getBoundingClientRect().height),e<a.bounds.handles[b].getBoundingClientRect().height&&(e=a.bounds.handles[b].getBoundingClientRect().height)):(e=c-a.bounds.bar.getBoundingClientRect().left,0>e&&(e=0),c+a.bounds.handles[b].getBoundingClientRect().width>a.bounds.bar.getBoundingClientRect().right&&(e=a.bounds.bar.getBoundingClientRect().width-a.bounds.handles[b].getBoundingClientRect().width)),a.getValue(e,b),a.dual&&a.value[0]>a.value[1]&&(0===b?a.setValue(a.value[0],1):a.setValue(a.value[1],0))},a.focusCB=function(c){c?b.on("keydown",a.keydown):b.unbind("keydown",a.keydown)},a.touchBarCB=function(b){var c,d=0,e=b.changedTouches,f=a.value[d];if(b.preventDefault(),a.dual){c=a.vertical?(e[0].pageY-a.bounds.bar.getBoundingClientRect().bottom)/a.bounds.bar.getBoundingClientRect().height:(e[0].pageX-a.bounds.bar.getBoundingClientRect().left)/a.bounds.bar.getBoundingClientRect().width;var g=Math.abs(c-a.relative[0]),h=Math.abs(c-a.relative[1]);g>h&&(d=1)}a.moveHandle(d,e[0].pageX,e[0].pageY),a.callback&&f!==a.value[d]&&a.callback(a.value[d],a.ctrlhandle)},a.touchHandleCB=function(c,e){function f(b){b.preventDefault();for(var c=b.changedTouches,d=0;d<c.length;d++)a.moveHandle(e,c[d].pageX,c[d].pageY)}function g(){b.unbind("touchmove",f),b.unbind("touchend",g),d.on("touchstart",a.touchBarCB),a.callback&&h!==a.value[e]&&a.callback(a.value[e],a.ctrlhandle)}var h=a.value[e];c.preventDefault(),b.on("touchmove",f),b.on("touchend",g),d.unbind("touchstart",a.touchBarCB)},a.handleCB=function(c,d){function e(b){a.moveHandle(d,b.clientX,b.clientY)}function f(){b.unbind("mousemove",e),b.unbind("mouseup",f),a.callback&&g!==a.value[d]&&a.callback(a.value[d],a.ctrlhandle)}var g=a.value[d];c.preventDefault(),b.on("mousemove",e),b.on("mouseup",f),a.handles[d][0].focus(),a.actif=d},a.find=function(a,b){var c;c=b?b[0].querySelector(a):d[0].querySelector(a);var e=angular.element(c);return e},a.initialSettings=function(b){var c;a.value=[],a.relative=[],null===a.precision&&(c=(""+a.byStep).match(/\.([\d]*)/),a.precision=c&&c[1]?c[1].length:0),d.on("touchstart",a.touchBarCB),a.handles[0].on("touchstart",function(b){a.touchHandleCB(b,0)}),a.dual&&(a.handles[1].addClass("range-slider-handle"),a.handles[1].on("touchstart",function(b){a.touchHandleCB(b,1)}),a.initvalues||a.setValue(b[1],1)),a.initvalues?a.initWidget(a.initvalues):a.setValue(b[0],0)},a.init=function(){if(a.sliderid=e.id||"slider-"+parseInt(1e3*Math.random()),a.startValue=-1/0,a.stopValue=1/0,a.byStep=parseInt(e.byStep)||1,a.vertical=e.vertical||!1,a.dual=e.dualHandles||!1,a.trigger_input_change=!1,a.notMore=parseInt(e.notMore)||100,a.notLess=parseInt(e.notLess)||0,a.vertical&&d.addClass("vertical-range"),a.handles=[a.find(".handle-min"),a.find(".handle-max")],a.bar=d,a.slider=a.find(".range-slider-active-segment"),a.start=a.find(".bzm-range-slider-start"),a.stop=a.find(".bzm-range-slider-stop"),a.disable=e.disable||!1,a.ctrlhandle=new RangeSliderHandle(a),a.bounds={bar:d[0],handles:[a.handles[0][0],a.handles[1][0]]},"true"===e.disable&&a.setDisable(!0),e.displayTarget)switch(e.displayTarget){case!0:case"handle":a.displays=a.handles,a.handles[0].addClass("bzm-range-slider-display"),a.dual&&a.handles[1].addClass("bzm-range-slider-display");break;default:a.displays=[b.getElementById(e.displayTarget)]}else a.displays=[];if(e.initial){var c=e.initial.split(",");a.initial=[void 0!==c[0]?parseInt(c[0]):a.notLess,void 0!==c[1]?parseInt(c[1]):a.notMore]}else a.initial=[a.notLess,a.notMore];a.$watch("startAt",function(){a.value<a.startAt,a.startAt&&a.setStart(a.startAt)}),a.$watch("stopAt",function(){a.value>a.stopAt,a.stopAt&&a.setStop(a.stopAt)}),a.initialSettings(a.initial)},a.init(),a.inithook&&a.inithook(a.ctrlhandle),a.$watch("initvalues",function(){a.initvalues&&a.initWidget(a.initvalues)})}var e='<div class="bzm-range-slider range-slider" title="{{title}}"data-slider><span class="range-slider-handle handle-min" ng-mousedown="handleCB($event,0)" ng-focus="focusCB(true)" ng-blur="focusCB(false)" role="slider" tabindex="0"></span><span class="handle-max" ng-mousedown="handleCB($event,1)" ng-focus="focusCB(true)" ng-blur="focusCB(false)" role="slider" tabindex="0"></span><span class="range-slider-active-segment"></span><span class="bzm-range-slider-start" ></span> <span class="bzm-range-slider-stop"></span> <input id={{sliderid}} type="hidden"></div>';return{restrict:"E",scope:{startAt:"=",stopAt:"=",callback:"=",formatter:"=",inithook:"=",cbhandle:"=",initvalues:"="},require:"?ngModel",template:e,replace:!0,link:d}}var RangeSlider=angular.module("bzm-range-slider",[]);RangeSlider.directive("rangeSlider",["$log","$document","$timeout",bzmFoundationSlider]);